# Generating <cite class='it'>R</cite> documentation

When your code uses offensive programming features, it becomes much easier to
generate (ref:R) documentation, as now, several information might be deduced and reused
for manual pages composition. Let's see how. 


## Automated <cite class='it'>R</cite> documentation generation 

Using package (ref:RD), manual pages <cite class='comment'><cite class='kw'>.Rd</cite> files stored in <cite class='fd'>man</cite> folder in a package context</cite> can be automatically created and filled up nearly to completion, depending on the level of offensive programming instrumentation of your code.

Generated manual pages uses English language. Feel free to modify produced English, to 
match your own English flavor, if needed. 

The level of your (ref:R) code instrumentation will impact the quality of the generation and your review work depth and time. When using both function return type instrumentation and test case instrumentation, expects produced manual page content to be fully generated and ready for review. 

No automated generation of manual page is possible when your code is not offensive programming instrumented. In such a case, rely either on standard (ref:R) tools to generate documentation or use package (ref:RD) to create the artifact program that will reduce the burden of documentation generation. 


## Focus on <cite class='kw'>R</cite> documentation generation

Package (ref:RD) generates manual page sections, presented below with their information source and your remaining duties. 

R manual section | information source | your duty 
:----------------|:--------------|:-------------------------------------------
name | (ref:R) code | none
alias | (ref:R) code | none, unless you want to add extraneous aliases
title | (ref:R) code | none
usage | (ref:R) code | none
arguments | (ref:R) code | none
value | (ref:R) code | none if your code is function return type instrumented. Otherwise, you will have to write explicitly this part. 
details | (ref:R) code | you may complete this part that is generated when your code is function test case instrumented.
references | your instruction | Generated from instructions you may provide.
author | package DESCRIPTION | none
seealso | your instruction | Generated from instructions you may provide.
keyword | your instruction | Generated from instructions you may provide.
examples | (ref:R) code | none when your code is function test case instrumented.
concept | your instruction | Generated from instructions you may provide.


Missing sections can be added on your instruction when generating manual pages. Package
(ref:RD) provides a convenient and easy way to do so.

The generated manual page can be used as-is, and should be immediately viewable and usable. From a format point of view, it complies with  <cite class='kw'>.Rd</cite> file syntax. From a content point of view, generated content aims to be reliable and express in human readable English wherever this makes sense. Indeed, you may bring desired enhancements to generated English sentences as you want. 

Generated manual page requires review. You may add extraneous content, modify
provided content and beautify the result. See known limits section <cite class='comment'>\@ref(known-limits)</cite> to know more.

## package <cite class='it'>wyz.code.rdoc</cite> utilities

The package (ref:RD) can be used to produce (ref:R) documentation parts and (ref:R) documentation generation programs. 

Here under are presented a few utilities that will greatly help you in producing high quality manual pages. Please, take time to read the full paragraph as it will mind you about some very convenient (ref:R) functions to produces (ref:R) code documentation snippets. For more information, refer to respective manual pages. 

### Generate a <cite class='it'>R</cite> documentation section

Use function <cite class='kw'>generateSection</cite> to generate a standard manual page section. Provide section name as first argument, and content as second. 

```{r rdoc1, echo=TRUE, eval=TRUE}
library(wyz.code.rdoc)

print(generateSection('note', 'A note text.'))
```

This function does not allow you to generate a customized <cite class='comment'>non standard</cite> manual page section. To do so, use <cite class='kw'>generateContent</cite>.  

### Format an English sentence

Use function <cite class='kw'>sentensize</cite> to format a sentence. 

```{r rdoc2, echo=TRUE, eval=TRUE}
sentensize('some text \t\b  will  \n\b be generated')
```

This functions ensures sentence starts with an upper-cased letter, adds a final dot if missing, and normalizes spaces, to ease readability. 

### Generate some <cite class='it'>R</cite> documentation content

Use function <cite class='kw'>generateContent</cite> to generate some (ref:R) documentation content. Beware, as argument order is opposite to the one used for <cite class='kw'>generateSection</cite>.

```{r rdoc3, echo=TRUE, eval=TRUE}
print(generateContent('a title', 'title'))
print(generateContent('https://neonira.github.io/offensiveProgrammingBook/', 'href',
                      'Offensive Programming Book'))
print(generateContent('warning', 'section', 'Warning section content ...'))
print(generateContent('a', 'item', 'description of a', useSpace_b_1 = TRUE))
print(generateContent('a', 'item', 'description of a', useSpace_b_1 = FALSE))
```

### Generate cross-ref to other <cite class='it'>R</cite> package

Use function <cite class='kw'>generateSpecialLink</cite> to generate a (ref:R) documentation cross-ref to any other (ref:R) package.

```{r rdoc4, echo=TRUE, eval=TRUE}
print(generateSpecialLink('wyz.code.offensiveProgramming', 'runTransientFunction'))
```

## Manual pages generation

Simply use <cite class='kw'>generateDocumentationContent</cite> to do so. 

### Context setup

I will reuse some classes delivered with (ref:PKN) to ease demonstration of (ref:R) documentation generation. 

```{r rdoc5, echo=TRUE, eval=TRUE}

target_folder <- 'man' #"~/tmp/generated-doc"
if (!dir.exists(target_folder)) dir.create(target_folder)

source_package <- 'wyz.code.offensiveProgramming'

source_files <- c(
  'code-samples/both-defs/good/full/AdditionTCFIG1.R',
  'code-samples/no-defs/Addition.R',
  'code-samples/frt-defs/good/partial/AdditionFIPartial.R',
  'code-samples/tcd-defs/good/partial/AdditionTCPartial.R'
)

invisible(sapply(source_files, function(e) {
  source(system.file(e, package = source_package))
}))
```

### Method manual page

Use keyword **method** to generate a dedicated manual page for an S3 method. 

```{r rdoc6, echo=TRUE, eval=TRUE}
object <- AdditionTCFIG1()
package_name <- 'zorg'

refs <- list(
  list(url = 'https://cran.r-project.org/doc/manuals/R-exts.html',
       label = 'Writing R extensions',
       comment = 'to know more about R documentation requirements'),
  list(url = 'https://www.burns-stat.com/pages/Tutor/R_inferno.pdf',
       label = 'The R Inferno',
       comment = 'to discover some well-known R weirdness')
)

extra_method <- list(
  keyword = c('classes', 'environment', 'utilities', 'misc'),
  concept = c('evaluation mode', 'standard evaluation',
              'function return type evaluation', 'parameter check evaluation'),
  references = c(sentensize(paste('see',
                                  generateContent('wyz.code.offensiveProgramming', 'code'),
                                  'package documentation')),
                 '',
                 sentensize(paste('You may read',
                                  generateContent('https://neonira.github.io/offensiveProgrammingBook/',
                                                  'href', 'Offensive Programming Book'),
                                  'to get introduction and expert advices on offensive programming')),
                 '',
                 generateReference(refs[[1]])
  ),
  seealso = c(sentensize(paste('see',
                               generateContent(generateSpecialLink('wyz.code.offensiveProgramming',
                                                                   'runTransientFunction'),
                                               'code'),
                               'to call interactively an offensive programming function, whether instrumented or not.')),
              '',
              sentensize(paste('see',
                               generateContent(generateSpecialLink('wyz.code.offensiveProgramming',
                                                                   'runTestCase'),
                                               'code'),
                               'to reuse on-demand instrumented offensive programming function tests'))
  )
)

# explicit invocation for method
generateDocumentationContent(target_folder, 'method', 'addMultiDouble',
                             object, package_name,
                             extra_method, overwrite_b_1 = TRUE)

```

Note how parameter <cite class='oc'>extra_method</cite> allows you to provide specific content as instruction to be considered for manual page generation. The extraneous content must be a <cite class='oc'>list</cite>, where names are manual page sections, and where content is (ref:R) documentation content. 

You may use function <cite class='kw'>generateDocumentationContent</cite> to generate your own (ref:R) documentation generation scripts. This allows you to generate programmatically your manual pages, in a customized way. 

Note that parameter <cite class='oc'>package_name</cite> is the name of the target package you want to generate documentation for. Here, files are taken from the (ref:PKN) package, and documentation is generated for package <cite class='it'>zorg</cite>. Really useful when programming, not so useful when used interactively. 

### Class manual page

Use keyword **class** to create a manual page for a class. Provide the class name. 

```{r rdoc7, echo=TRUE, eval=TRUE}
extra_class <- extra_method
extra_class$references <- extra_method$references[[5]]
extra_class$seealso <- NULL
generateDocumentationContent(target_folder, 'class', 'AdditionTCFIG1',
                             object, package_name,
                             extra_class, overwrite_b_1 = TRUE)
```

### Package manual page

Use keyword **class** to generate a summary manual page for your package. Provide explicitly, all the class names you desired to emphase over.  

```{r rdoc8, echo=TRUE, eval=TRUE}
extra_package <- extra_method
extra_package$seealso <- NULL
extra_package$content <- c('AdditionTCFIG1', 'AdditionTCFIP', 'Addition')
z <- generateDocumentationContent(target_folder, 'package', package_name,
                                  object, package_name, extra_package, overwrite_b_1 = TRUE)
```

Result is 
<pre>
\name{zorg-package}
\alias{zorg-package}
\alias{zorg}
\docType{package}
\title{\packageTitle{zorg}}
\description{
\packageDescription{zorg}
}
\details{
Most important package entries are
\itemize{
\item{\code{\link{AdditionTCFIG1}}}{}
\item{\code{\link{AdditionTCFIP}}}{}
\item{\code{\link{Addition}}}{}
}
}
\references{
See \code{wyz.code.offensiveProgramming} package documentation.

You may read \href{https://neonira.github.io/offensiveProgrammingBook/}{Offensive Programming Book} to get introduction and expert advices on offensive programming.

Refer to \href{https://cran.r-project.org/doc/manuals/R-exts.html}{Writing R extensions} to know more about R documentation requirements.
}
\author{
\packageAuthor{zorg}

Maintainer: \packageMaintainer{zorg}
}
\keyword{classes}
\keyword{environment}
\keyword{utilities}
\keyword{misc}
\concept{evaluation mode}
\concept{standard evaluation}
\concept{function return type evaluation}
\concept{parameter check evaluation}
</pre>

### In one shot

To simplify your life, you can create in one shot all the manual pages related to
methods of a class. Simply pass <cite class='bo'>NA</cite> as value for the name. 

```{r rdoc9, echo=TRUE, eval=TRUE}
generateDocumentationContent(target_folder, 'method', NA,
                             AdditionTCPartial(), package_name,
                             extra_method, overwrite_b_1 = TRUE)
```


### and a special case, from a standalone function 


When you own an offensive programming instrumented function, it is quite easy to get a pre-filled (ref:R) documentation file from it. Be sure to pass NULL as value for parameter <cite class='kw'>object_o_1</cite>. 

```{r rdoc10, echo=TRUE, eval=TRUE}
sumValues <- function(x_i, y_i) sum(x_i, y_i, na.rm = TRUE)
gmf <- generateDocumentationContent(target_folder, 'method', 'sumValues',
                                    NULL, package_name,
                                    extra_method, overwrite_b_1 = TRUE)
print(gmf)
```

Indeed, this convenience suffers from two drawbacks

1. As the return type of the function is unknown, <cite class='kw'>value</cite> section cannot be documented,
1. As they are no test case definitions, <cite class='kw'>examples</cite> section cannot be documented

## Known-limits

Generation of manual pages can be quite tricky. Whereas package (ref:RD)
alleviates greatly the burden, some pitfalls remain. Here they are

1. Generated manual page might not respect the maximum line length required by **R CMD check**, and this tool will provide explicit information about un-compliance. To solve issue, just split the content by adding carriage return wherever required.
1. Generated documentation is quite stereotyped. Inject your instruction to customize
the result.  

## Opportunities

Reuse can be made at several levels depending of your needs. Roughly speeking, you maty aim for one of these 3 levels of customization
1. just customize some textual information. Generate the pages using package (ref:RD) and modify page contents manually is generally the best way to achieve this goal
1. customize some manual pages sections. Generate the pages using package (ref:RD) while providing some dedicated context information. Refer to previous examples, and look at variables starting with <cite class='kw'>extra_</cite>. They allow you to inject your customized content in targeted sections. 
1. If you seek for fully customized manual page generation, then you may use package (ref:rd) to create your own (ref:R) generation scheme. That way you will get the benefit of starting launched, using high-level (ref:R) documentation generation functions, and also get the ability to reuse and customized provided generation scheme. This package uses only (ref:R) code, and so you could get insight and reuse any part of it. 







